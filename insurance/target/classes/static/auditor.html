<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - SecureLife Feedbacks</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --ash: #B2BEB5;
            --accent: #7C3AED;
            --accent-dark: #5B21B6;
            --accent-soft: #A78BFA;
            --shadow: 0 10px 25px rgba(17, 24, 39, 0.08);
            --radius: 18px;
            --transition: all .3s ease;
        }
        body {
            font-family: 'Montserrat', sans-serif;
            margin: 20px;
            background: linear-gradient(180deg, #fafafa 0%, #f3f4f6 100%);
            color: #1f2937;
        }
        h1 {
            text-align: center;
            font-family: 'Playfair Display', serif;
            color: var(--accent-dark);
            margin-bottom: 2rem;
        }
        .reviews-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }
        .testimonial {
            border: 1px solid rgba(124, 58, 237, 0.12);
            padding: 20px;
            width: 300px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            background: #fff;
            transition: var(--transition);
        }
        .testimonial:hover {
            transform: translateY(-4px);
            box-shadow: 0 14px 30px rgba(17, 24, 39, 0.10);
        }
        .delete-btn {
            background: linear-gradient(135deg, #EF4444, #B91C1C);
            color: white;
            border: none;
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 10px;
            font-weight: 800;
            transition: var(--transition);
        }
        .delete-btn:hover {
            background: linear-gradient(135deg, #B91C1C, #991B1B);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(239, 68, 68, 0.3);
        }
    </style>
</head>
<body>
<h1>Admin Panel - Manage Feedbacks</h1>
<div class="reviews-grid" id="admin-reviews-list"></div>

<script>
    async function getReviews() {
        try {
            const response = await fetch('/api/feedbacks');
            if (!response.ok) throw new Error('Failed to fetch');
            return await response.json();
        } catch (e) {
            console.error(e);
            return [];
        }
    }

    async function deleteFeedback(id) {
        if (!confirm('Are you sure you want to delete this feedback?')) return;
        try {
            const response = await fetch(`/api/feedbacks/${id}`, { method: 'DELETE' });
            if (!response.ok) throw new Error('Failed to delete');
            location.reload();
        } catch (e) {
            console.error(e);
            alert('Failed to delete');
        }
    }

    function renderAdminReviewCard(review) {
        const card = document.createElement('div');
        card.className = 'testimonial';

        const textDiv = document.createElement('div');
        textDiv.textContent = review.reviewText;

        const authorDiv = document.createElement('div');
        authorDiv.innerHTML = `<h4>${review.name}</h4><p>Rating: ${review.rating}/5 â€¢ ${new Date(review.createdAt).toLocaleDateString()}</p>`;

        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'delete-btn';
        deleteBtn.textContent = 'Delete';
        deleteBtn.onclick = () => deleteFeedback(review.id);

        card.appendChild(textDiv);
        card.appendChild(authorDiv);
        card.appendChild(deleteBtn);

        return card;
    }

    async function loadAdminReviews() {
        const reviews = await getReviews();
        const list = document.getElementById('admin-reviews-list');
        reviews.forEach(review => list.appendChild(renderAdminReviewCard(review)));
    }

    document.addEventListener('DOMContentLoaded', loadAdminReviews);
</script>
</body>
</html>